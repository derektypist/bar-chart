<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3 Bar Chart</title>
    <!-- Load Styles -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
    <style>
    /* Universal Styles */
    body {
        font-family: "Roboto", Arial, Verdana, sans-serif;
        margin: 0;
        padding: 0;
    }

    /* Title */
    #title {
        background-color: lightblue;
        color: purple;
    }

    /* Chart Holder */
    .visHolder {
        position: absolute;
        top: 6em;
    }

    /* Chart */
    #tooltip {
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        text-align: center;
        width: 150px;
        height: 50px;
        padding: 2px;
        font-size: 12px;
        background-color: lightgreen;
        box-shadow: 1px 1px 10px;
        border-radius: 2px;
        pointer-events: none;
    }

    .overlay {
        position: absolute;
        background-color: #ffffff;
        pointer-events: none;
    }

    #x-axis path {
        stroke: black;
        stroke-width: 1px;
        fill: none;
    }

    #y-axis path {
        stroke: black;
        stroke-width: 1px;
        fill: none;
    }

    .info {
        font-size: 0.8em;
    }

    </style>
    <!-- Load Scripts -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script>
    // Initialise variables
    let width = 800;
    let height = 400;
    let barWidth = width/275;
    
    // Set Up Tooltip
    let tooltip = d3
        .select(".visHolder")
        .append('article')
        .attr('id', 'tooltip')
        .style('opacity', 0);

    // Set Up Overlay
    let overlay = d3
        .select('.visHolder')
        .append('article')
        .attr('class', 'overlay')
        .style('opacity', 0);

    // Set Up SVG Container
    let svgContainer = d3
        .select('.visHolder')
        .append('svg')
        .attr('width', width + 100)
        .height('height', height + 60);

    // Use JSON Data
    d3.json(
        'https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json',
        function(e, data) {
            svgContainer
                .append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -200)
                .attr('y', 80)
                .text('Gross Domestic Product');

            svgContainer
                .append('text')
                .attr('x', width / 2 + 120)
                .attr('y', height + 50)
                .text('More Information: http://www.bea.gov/national/pdf/nipaguid.pdf')
                .attr('class', 'info');

            let years = data.data.map(function(item) {
                let quarter;
                // Get The Month Number (e.g. 01)
                let temp = item[0].substring(5, 7);

                // Apply If-Else Statements to Determine What Quarter Should Be
                if (temp === '01') {
                    quarter = 'Q1';
                } else if (temp === '04') {
                    quarter = 'Q2';
                } else if (temp === '07') {
                    quarter = 'Q3';
                } else if (temp === '10') {
                    quarter = 'Q4';
                }

                // Return Year and Quarter
                return item[0].substring(0, 4) + ' ' + quarter;
            });

            let yearsDate = data.data.map(function(item) {
                return new Date(item[0]);
            });

            // Set Up xMax, xScale and xAxis
            let xMax = new Date(d3.max(yearsDate));
            xMax.setMonth(xMax.getMonth() + 3);
            let xScale = d3
                .scaleTime()
                .domain([d3.min(yearsDate), xMax])
                .range([0, width]);

            let xAxis = d3.axisBottom().scale(xScale);

            svgContainer
                .append('g')
                .call(xAxis)
                .attr('id', 'x-axis')
                .attr('transform', 'translate(60, 400)');

            // Get GDP Data
            let GDP = data.data.map(function(item) {
                return item[1];
            });

            let scaledGDP = [];
            let gdpMax = d3.max(GDP);
            let linearScale = d3.scaleLinear().domain([0, gdpMax]).range([0, height]);
            scaledGDP = GDP.map(function(item) {
                return linearScale(item);
            });
        }
    );
    </script>
</head>
<body>
    <!-- Set Up Title -->
    <header class="text-center container-fluid" id="title">
        <h1>United States GDP</h1>
    </header>

    <!-- Set Up Chart -->
    <section class="container-fluid visHolder"></section>
</body>
</html>